<template>
  <!-- <transition name="fade"> -->
  <div class="patient-block">
    <div class="patient-block__inner">
      <div class="patient-block__new" v-if="parameters.new">Новый</div>
      <div class="patient-block__main">
        <div class="patient-block__name">
          {{ parameters.surname }} {{ parameters.name }}
          {{ parameters.patronymic }}
        </div>
        <div class="patient-block__data">
          <div
            class="patient-block__status"
            :class="{ '--green': haveSpecialMenu(parameters.selected) }"
          ></div>
          <div class="patient-block__data-item">Палата № {{ parameters.ward }}</div>
          <div class="patient-block__data-item">{{ getDietNameById(parameters.diet) }}</div>
          <div class="patient-block__data-item">{{ parameters.hospitalization }}</div>
        </div>
      </div>
      <div class="patient-block__controls" v-if="parameters.archived">
        <a href="#" class="patient-block__controls-item" @click.prevent="unArchivePatient">
          <div class="patient-block__controls-ico">
            <svg
              width="29"
              height="26"
              viewBox="0 0 29 26"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M27.6941 11.9778C27.6941 9.50439 27.004 7.03234 25.6981 4.82849C24.9817 3.62401 24.1058 2.52438 23.0942 1.5608L28.2598 1.67184C28.6599 1.68079 28.9916 1.35936 29 0.953742L29 0.937683C28.9998 0.538484 28.6846 0.212702 28.2904 0.204213L21.1784 0.0509571C20.9099 -0.0559547 20.6045 0.00851355 20.4004 0.214766C20.1965 0.421019 20.1324 0.730053 20.2377 1.00192L20.3891 8.20562C20.3934 8.61101 20.7212 8.93633 21.1218 8.93197C21.5219 8.92762 21.8434 8.59564 21.8391 8.19002L21.8391 8.17419L21.7153 2.27706C22.7933 3.22757 23.7179 4.34349 24.4552 5.58376C25.626 7.55933 26.2446 9.77052 26.2446 11.9778C26.2446 15.5075 24.8061 18.7621 22.1948 21.1424C19.8661 23.2646 16.7459 24.5312 13.8478 24.5312C10.9493 24.5312 7.82913 23.2646 5.50053 21.1424C2.88872 18.7621 1.45027 15.5075 1.45027 11.9778C1.43623 9.9084 1.94781 7.86997 2.93652 6.05866C3.85954 4.39625 5.13621 2.96235 6.67366 1.86089C7.00218 1.62917 7.08306 1.17147 6.85423 0.8388C6.62541 0.506134 6.17342 0.424 5.8449 0.655719C5.84082 0.658931 5.83674 0.661914 5.83244 0.664667C4.11918 1.89392 2.69659 3.49301 1.66868 5.34699C0.559887 7.37579 -0.0144486 9.65925 0.000277949 11.9778C0.000277777 15.9294 1.60887 19.5718 4.53016 22.2338C7.11772 24.592 10.6004 26 13.8471 26C17.0939 26 20.5769 24.5923 23.1644 22.2338C26.0855 19.5718 27.6941 15.9294 27.6941 11.9778Z"
                fill="#B06666"
              />
            </svg>
          </div>
          <div class="patient-block__controls-text --red">Восстановить из архива</div>
        </a>
      </div>
      <div class="patient-block__controls" v-else>
        <nuxt-link :to="'/patient-menu?id=' + parameters.id" class="patient-block__controls-item">
          <div class="patient-block__controls-ico">
            <svg
              width="21"
              height="32"
              viewBox="0 0 21 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M17.4134 25.4273H18.8898C19.8681 25.4273 20.6661 24.6387 20.6661 23.666V2.61133C20.6661 1.63864 19.8681 0.85 18.8898 0.85H1.54211C1.16115 0.85 0.85 1.15629 0.85 1.53711V24.7402C0.85 25.121 1.16115 25.4273 1.54211 25.4273H11.6923V30.4628C11.6923 30.7017 11.8173 30.9227 12.0209 31.0477L12.0211 31.0478C12.2249 31.1724 12.4791 31.1839 12.6934 31.0777L14.5528 30.1565L16.4122 31.0777C16.6261 31.1836 16.8805 31.1727 17.0846 31.0477L17.0847 31.0477C17.2887 30.9227 17.4134 30.7016 17.4134 30.4628V25.4273ZM14.2439 28.7737L14.2438 28.7738L13.0765 29.3521V25.4273H16.0292V29.3521L14.8619 28.7738L14.7953 28.9082L14.8619 28.7738C14.7646 28.7255 14.6585 28.7015 14.5528 28.7015C14.4471 28.7015 14.3413 28.7256 14.2439 28.7737ZM5.25686 4.00781V24.0531H2.23423V2.22422H5.25686V3.8692V4.00781ZM6.64109 2.22422H18.8898C19.1072 2.22422 19.2819 2.39923 19.2819 2.61133V23.666C19.2819 23.8781 19.1072 24.0531 18.8898 24.0531H18.8868H18.8836H18.8802H18.8765H18.8725H18.8684H18.8639H18.8593H18.8543H18.8492H18.8438H18.8382H18.8323H18.8262H18.8198H18.8132H18.8064H18.7994H18.7921H18.7846H18.7768H18.7688H18.7606H18.7522H18.7435H18.7347H18.7255H18.7162H18.7066H18.6969H18.6869H18.6766H18.6662H18.6555H18.6447H18.6336H18.6223H18.6107H18.599H18.587H18.5749H18.5625H18.5499H18.5372H18.5242H18.511H18.4976H18.4839H18.4701H18.4561H18.4419H18.4275H18.4128H18.398H18.383H18.3678H18.3524H18.3368H18.321H18.305H18.2888H18.2725H18.2559H18.2392H18.2222H18.2051H18.1878H18.1703H18.1526H18.1347H18.1167H18.0985H18.0801H18.0615H18.0427H18.0238H18.0047H17.9854H17.9659H17.9463H17.9265H17.9065H17.8863H17.866H17.8455H17.8249H17.804H17.7831H17.7619H17.7406H17.7191H17.6975H17.6757H17.6537H17.6316H17.6093H17.5869H17.5643H17.5416H17.5187H17.4956H17.4724H17.4491H17.4256H17.4019H17.3781H17.3542H17.3301H17.3058H17.2815H17.2569H17.2323H17.2075H17.1825H17.1574H17.1322H17.1069H17.0814H17.0557H17.03H17.0041H16.9781H16.9519H16.9256H16.8992H16.8726H16.846H16.8192H16.7922H16.7652H16.738H16.7107H16.6833H16.6558H16.6281H16.6003H16.5724H16.5444H16.5163H16.4881H16.4597H16.4312H16.4027H16.374H16.3452H16.3163H16.2873H16.2581H16.2289H16.1996H16.1702H16.1406H16.111H16.0812H16.0514H16.0215H15.9914H15.9613H15.9311H15.9007H15.8703H15.8398H15.8092H15.7785H15.7477H15.7168H15.6859H15.6548H15.6237H15.5925H15.5612H15.5298H15.4983H15.4668H15.4351H15.4034H15.3716H15.3398H15.3078H15.2758H15.2437H15.2115H15.1793H15.147H15.1146H15.0821H15.0496H15.017H14.9844H14.9517H14.9189H14.886H14.8531H14.8202H14.7871H14.754H14.7209H14.6877H14.6544H14.6211H14.5877H14.5543H14.5208H14.4872H14.4537H14.42H14.3863H14.3526H14.3188H14.285H14.2511H14.2172H14.1832H14.1492H14.1152H14.0811H14.047H14.0128H13.9786H13.9444H13.9101H13.8758H13.8415H13.8071H13.7727H13.7383H13.7038H13.6693H13.6348H13.6003H13.5657H13.5311H13.4965H13.4618H13.4272H13.3925H13.3578H13.3231H13.2883H13.2536H13.2188H13.184H13.1492H13.1144H13.0796H13.0447H13.0099H12.975H12.9402H12.9053H12.8704H12.8355H12.8007H12.7658H12.7309H12.696H12.6611H12.6262H12.5913H12.5564H12.5215H12.4867H12.4518H12.4169H12.3821H12.3472H12.3124H12.2775H12.2427H12.2079H12.1731H12.1383H12.1036H12.0688H12.0341H11.9994H11.9647H11.93H11.8954H11.8608H11.8262H11.7916H11.757H11.7225H11.688H11.6535H11.6191H11.5847H11.5503H11.5159H11.4816H11.4473H11.4131H11.3789H11.3447H11.3106H11.2765H11.2424H11.2084H11.1744H11.1405H11.1066H11.0728H11.039H11.0052H10.9715H10.9379H10.9043H10.8707H10.8372H10.8037H10.7704H10.737H10.7037H10.6705H10.6373H10.6042H10.5712H10.5382H10.5052H10.4724H10.4395H10.4068H10.3741H10.3415H10.309H10.2765H10.2441H10.2118H10.1795H10.1473H10.1152H10.0831H10.0512H10.0193H9.98746H9.95572H9.92406H9.89248H9.86098H9.82956H9.79823H9.76698H9.73581H9.70473H9.67374H9.64283H9.61202H9.58129H9.55066H9.52011H9.48966H9.4593H9.42904H9.39887H9.3688H9.33883H9.30896H9.27918H9.24951H9.21993H9.19046H9.16109H9.13183H9.10267H9.07362H9.04468H9.01584H8.98712H8.9585H8.93H8.90161H8.87333H8.84516H8.81711H8.78918H8.76136H8.73366H8.70608H8.67863H8.65129H8.62407H8.59698H8.57001H8.54316H8.51645H8.48985H8.46339H8.43706H8.41085H8.38478H8.35883H8.33302H8.30735H8.28181H8.2564H8.23113H8.206H8.18101H8.15616H8.13145H8.10687H8.08245H8.05816H8.03402H8.01003H7.98618H7.96248H7.93893H7.91552H7.89227H7.86917H7.84622H7.82342H7.80078H7.7783H7.75597H7.73379H7.71178H7.68992H7.66823H7.64669H7.62532H7.60411H7.58307H7.56219H7.54147H7.52093H7.50055H7.48034H7.4603H7.44043H7.42073H7.4012H7.38185H7.36268H7.34368H7.32485H7.30621H7.28774H7.26945H7.25135H7.23342H7.21568H7.19812H7.18074H7.16355H7.14655H7.12974H7.11311H7.09667H7.08043H7.06437H7.04851H7.03284H7.01736H7.00209H6.987H6.97212H6.95743H6.94294H6.92865H6.91456H6.90068H6.887H6.87352H6.86025H6.84718H6.83432H6.82167H6.80922H6.79699H6.78497H6.77316H6.76156H6.75018H6.73901H6.72806H6.71732H6.70681H6.69651H6.68643H6.67657H6.66693H6.65752H6.64833H6.64109V4.00781V3.8692V2.22422Z"
                fill="#629771"
                stroke="#629771"
                stroke-width="0.3"
              />
            </svg>
          </div>
          <div class="patient-block__controls-text --green">Составить меню</div>
        </nuxt-link>
        <nuxt-link :to="'/edit-patient?id=' + parameters.id" class="patient-block__controls-item">
          <div class="patient-block__controls-ico">
            <svg
              width="29"
              height="28"
              viewBox="0 0 29 28"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M26.1895 1.81237C23.7789 -0.604123 19.8588 -0.604123 17.4483 1.81237L1.42189 17.8328C1.29659 17.9581 1.21903 18.1192 1.19516 18.2923L0.00779774 27.0871C-0.0280022 27.3377 0.0614976 27.5883 0.23453 27.7613C0.383697 27.9105 0.592529 28 0.801362 28C0.837162 28 0.872962 28 0.908762 27.994L9.60814 26.8604C10.0497 26.8007 10.3599 26.395 10.3003 25.9534C10.2406 25.5119 9.83487 25.2016 9.39334 25.2613L1.74409 26.2518L2.57346 20.1181L9.02937 26.574C9.17854 26.7231 9.38737 26.8126 9.5962 26.8126C9.80504 26.8126 10.0139 26.7291 10.163 26.574L26.1895 10.5535C27.3589 9.38405 28.0033 7.83272 28.0033 6.17996C28.0033 4.5272 27.3589 2.97587 26.1895 1.81237ZM17.7586 3.78136L20.4495 6.47232L5.82528 21.0966L3.13432 18.4056L17.7586 3.78136ZM9.60217 24.8675L6.97088 22.2362L21.5951 7.61195L24.2264 10.2432L9.60217 24.8675ZM25.3482 9.09168L18.9101 2.65367C19.7276 1.97944 20.7479 1.6095 21.8219 1.6095C23.045 1.6095 24.1906 2.08684 25.0558 2.94603C25.921 3.80523 26.3923 4.95679 26.3923 6.17996C26.3923 7.25992 26.0224 8.27425 25.3482 9.09168Z"
                fill="#617AA0"
              />
            </svg>
          </div>
          <div class="patient-block__controls-text --blue">Редактировать информацию</div>
        </nuxt-link>
        <a href="#" class="patient-block__controls-item" @click.prevent="archivePatient">
          <div class="patient-block__controls-ico">
            <svg
              width="24"
              height="30"
              viewBox="0 0 24 30"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M16.2395 11.0445C15.8221 11.0445 15.4837 11.3828 15.4837 11.8003V24.1937C15.4837 24.6108 15.822 24.9494 16.2395 24.9494C16.6569 24.9494 16.9952 24.6108 16.9952 24.1937V11.8003C16.9952 11.3828 16.6569 11.0445 16.2395 11.0445Z"
                fill="#B06666"
                stroke="#B06666"
                stroke-width="0.2"
              />
              <path
                d="M8.50193 11.0445C8.08451 11.0445 7.74619 11.3828 7.74619 11.8003V24.1937C7.74619 24.6108 8.08448 24.9494 8.50193 24.9494C8.91938 24.9494 9.25767 24.6108 9.25767 24.1937V11.8003C9.25767 11.3828 8.91935 11.0445 8.50193 11.0445Z"
                fill="#B06666"
                stroke="#B06666"
                stroke-width="0.2"
              />
              <path
                d="M6.76238 4.30991H3.50507H3.50505C2.19665 4.31018 1.09147 5.28056 0.922055 6.5778L0.922052 6.57782C0.756246 7.84969 1.5403 9.04864 2.7624 9.41162V25.4918C2.7624 26.4707 3.12128 27.3926 3.75162 28.0557C4.37932 28.7208 5.25284 29.0984 6.16703 29.1H6.1672H18.5739H18.5741C19.4885 29.0984 20.362 28.7208 20.9895 28.0557C21.6198 27.3926 21.9787 26.4707 21.9787 25.4918V9.41162C23.2008 9.04864 23.9849 7.84969 23.8191 6.57782L23.8191 6.5778C23.6497 5.28056 22.5445 4.31018 21.2361 4.30991H17.9787L17.9787 3.5908C17.9787 3.59068 17.9787 3.59057 17.9787 3.59045V3.59024H17.8787L6.76238 4.30991ZM8.27386 3.59024H8.27386L8.27385 3.58897C8.26984 3.2746 8.39341 2.97199 8.61656 2.75003L8.6166 2.74999C8.83944 2.52808 9.14275 2.40612 9.45747 2.41154V2.41156H9.4592L15.2819 2.41157L15.2837 2.41154C15.5984 2.40612 15.9017 2.52808 16.1245 2.74999L16.1246 2.75006C16.3477 2.97174 16.4713 3.27457 16.4673 3.58897H16.4673V3.59024V4.30991H8.27386V3.59024ZM18.5739 27.5885H6.1672C5.11025 27.5885 4.27387 26.6796 4.27387 25.4918V9.4935H20.4673V25.4918C20.4673 26.6796 19.6309 27.5885 18.5739 27.5885ZM3.50507 5.82138H21.2361C21.8327 5.82138 22.3164 6.30504 22.3164 6.90171C22.3164 7.49837 21.8327 7.98203 21.2361 7.98203H3.50507C2.9084 7.98203 2.42474 7.49837 2.42474 6.90171C2.42474 6.30504 2.9084 5.82138 3.50507 5.82138Z"
                fill="#B06666"
                stroke="#B06666"
                stroke-width="0.2"
              />
              <path
                d="M12.3706 11.0445C11.9532 11.0445 11.6148 11.3828 11.6148 11.8003V24.1937C11.6148 24.6108 11.9531 24.9494 12.3706 24.9494C12.788 24.9494 13.1263 24.6108 13.1263 24.1937V11.8003C13.1263 11.3828 12.788 11.0445 12.3706 11.0445Z"
                fill="#B06666"
                stroke="#B06666"
                stroke-width="0.2"
              />
            </svg>
          </div>
          <div class="patient-block__controls-text --red">В архив</div>
        </a>
      </div>
    </div>
  </div>
  <!-- </transition> -->
</template>

<script>
import { mapGetters } from "vuex";
export default {
  props: ["parameters"],
  computed: {
    ...mapGetters({ dietsList: "menu/dietsList" })
  },
  methods: {
    archivePatient: function() {
      let params = { id: this.parameters.id, patient: { ...this.parameters } };
      params.patient.archived = true;
      this.$store
        .dispatch("patients/editPatient", { ...params.patient })
        .then(() => {
          this.$store.dispatch("patients/fetchPatients", { self: this });
        });
    },
    unArchivePatient: function() {
      let params = { id: this.parameters.id, patient: { ...this.parameters } };
      params.patient.archived = false;
      this.$store
        .dispatch("patients/editPatient", { ...params.patient })
        .then(() => {
          this.$store.dispatch("patients/fetchPatients", { self: this });
          this.$store.dispatch("patients/fetchArchivedPatients", {
            self: this
          });
        });
    },
    getDietNameById(id) {
      var dietName = "";
      var diet = this.dietsList.find(dietEl => {
        return dietEl.id === id;
      });
      if (diet) dietName = diet.name;
      return dietName;
    },
    haveSpecialMenu(selected) {
      var result = false;
      selected.forEach(element => {
        if (element.length) result = true;
      });
      return result;
    }
  }
};
</script>

<style></style>
